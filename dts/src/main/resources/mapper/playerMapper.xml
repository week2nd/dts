<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="player">
	<!-- <resultMap type="player" id="playerResult"></resultMap> -->



	<!-- 선수 전체 보기 -->
	<select id="getPlayerList" parameterType="player" resultType="player">
		SELECT	RANK() OVER(ORDER BY WIN DESC) playerRank,
				NAME, 
				NICKNAME, 
				TEAM_ID,
				WIN+LOSE match, 
				WIN, 
				LOSE,			 
				WIN/NULLIF((WIN+LOSE),0) * 100 winrate,
				KILL, 
				DEATH, 
				ASSIST,
				FUNC_PLAYERKDA(NICKNAME) kda
		FROM 	PLAYER
		<if test="searchKeyword != null and searchKeyword != ''">
		WHERE 	${searchCondition} like '%' || #{searchKeyword} || '%'
		</if>
		
	</select>
	
	<select id="getPlayer"	parameterType="player" resultType="player">
		SELECT	P.TEAM_ID playerId,
				P.NAME name, 
				T.NAME teamId, 
				P.NICKNAME nickname,
			    P.WIN WIN,
			    P.LOSE lose, 
			    P.KILL kill,
			    P.DEATH death, 
			    P.ASSIST assist,
			    FUNC_PLAYERKDA('${nickname}') kda
		FROM	PLAYER P
		JOIN	TEAM T
		ON		P.TEAM_ID = T.TEAM_ID
		WHERE	P.NICKNAME = #{nickname}
	</select>
	
	<select id="playerRecordList" parameterType="player" resultType="player">
		 SELECT	DISTINCT *
		FROM	(SELECT	MATCHDATE, 
						MATCHNAME,
						MATCHINFO,             BLUETEAMNAME,
						BLUEGAMER3,
						REDGAMER3,
						GAME_ID,
						BLUERESULT,
						BLUEPICK3_KILL,
						BLUEPICK3_DEATH,
						BLUEPICK3_ASSIST,
						BLUEPICK3,
						BLUEPICK3_SPELL1,
						BLUEPICK3_SPELL2
				FROM	INGAME I
				JOIN	PLAYER P
				ON 		P.TEAM_ID = I.BLUETEAMNAME
				WHERE	BLUEGAMER3 = #{nickname})
			 
	</select>
	
	
 	<insert id="insertPlayer" parameterType="player">
 		INSERT INTO PLAYER(PLAYER_ID, 
 							NICKNAME, 
 							NAME, 
 							LINE, 
 							TEAM_ID)
		VALUES(PLAYER_SEQ.NEXTVAL, 
							#{nickname}, 
							#{name}, 
							#{line}, 
							#{teamId})
 	</insert>
 	
 	<update id="updatePlayer" parameterType="player">
 		UPDATE 	PLAYER
 		SET		WIN = #{win} , 
 				LOSE = #{lose} , 
 				KILL = #{kill} , 
 				DEATH = #{death} , 
 				ASSIST = #{assist}
 		WHERE 	NICKNAME = #{nickname}
 	</update>
 	
 	<delete id="deletePlayer" parameterType="player">
 		DELETE	PLAYER
 		WHERE	PLAYER_ID = #{playerId}
 	</delete>
</mapper> 