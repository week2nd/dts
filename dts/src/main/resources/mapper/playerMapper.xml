<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="player">
	<!-- <resultMap type="player" id="playerResult"></resultMap> -->



	<!-- 선수 전체 보기 -->
	<select id="getPlayerList" resultType="player">
		SELECT	RANK() OVER(ORDER BY WIN DESC) playerRank,
				NAME, 
				NICKNAME, 
				TEAM_ID,
				WIN+LOSE match, 
				WIN, 
				LOSE,			 
				WIN/NULLIF((WIN+LOSE),0) * 100 winrate,
				KILL, 
				DEATH, 
				ASSIST, 
				ROUND((KILL+ASSIST)/NULLIF(DEATH,0),1) kda
		FROM 	PLAYER
	</select>
		<select id="getPlayer"	parameterType="player" resultType="player">
		SELECT	P.TEAM_ID||' '||NICKNAME playerId, P.NAME name, 
				T.NAME teamId, 
				P.NICKNAME nickname,
			    P.WIN WIN,
			    P.LOSE lose, 
			    P.KILL kill,
			    P.DEATH death, 
			    P.ASSIST assist
		FROM	PLAYER P
			JOIN	TEAM T
		ON		P.TEAM_ID = T.TEAM_ID
		WHERE	P.NICKNAME = #{nickname}
	</select>
	<select id="getPlayerNotJoin" parameterType="player" resultType="player">
		SELECT	*
		FROM	PLAYER
		WHERE	NICKNAME = #{nickname}
	</select>
	<!-- 단일 유저 조회 -->
<!--  	<select		id="getPlayer"	parameterType="player" resultType="player">
		SELECT	*
		FROM	PLAYER
		WHERE	NICKNAME = #{nickname}
	</select>
 -->
 
 	<insert id="insertPlayer" parameterType="player">
 		INSERT INTO PLAYER(PLAYER_ID, 
 							NICKNAME, 
 							NAME, 
 							LINE, 
 							TEAM_ID)
		VALUES(PLAYER_SEQ.NEXTVAL, 
							#{nickname}, 
							#{name}, 
							#{line}, 
							#{teamId})
 	</insert>
 	
 	<update id="updatePlayer" parameterType="player">
 		UPDATE 	PLAYER
 		SET		WIN = #{win} , 
 				LOSE = #{lose} , 
 				KILL = #{kill} , 
 				DEATH = #{death} , 
 				ASSIST = #{assist}
 		WHERE 	NICKNAME = #{nickname}
 	</update>
</mapper> 