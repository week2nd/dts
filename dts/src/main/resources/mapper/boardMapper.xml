<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="board">


 <!-- 전체게시판조회 -->
 <select id="getBoardList" resultType="board">	
	select  b.* from( select a.*, rownum rn from  (	
 		SELECT *
		FROM BOARD 
		
	<!--  WHERE 1=1 -->
	 <if test="searchKeyword != null and searchKeyword == ''">
		WHERE ${searchCondition} like '%' || #{searchKeyword} || '%'
	</if>
	<if test="searchKeyword == null or searchKeyword != ''">
	</if> 
 	<choose>
		<when test="sortCol != null and sortCol != ''">
			ORDER BY ${sortCol}	
		</when>
		<otherwise>
			ORDER BY BOARD_NUMBER DESC
		</otherwise>
	</choose>
	) a ) b where rn between #{first} and #{last}	
</select> 


 <!-- 페이지 전체 건수 조회 -->
 <select id="getCount" parameterType="board" resultType="int">
 	SELECT COUNT(*)
 	FROM	BOARD 
	WHERE 	BOARD_TYPE=#{boardType}
	<if test="searchKeyword != null and searchKeyword != ''">
		 AND ${searchCondition} like '%' || #{searchKeyword} || '%'
		</if>
	<choose>
		<when test="sortCol != null and sortCol != ''">
			ORDER BY ${sortCol}	
		</when>
		<otherwise>
			ORDER BY BOARD_NUMBER DESC
		</otherwise>
	</choose>
 </select>
 

	<!-- 분석게시판조회 -->
	<select id="getAnalysisBoard" resultType="board">
	select b.* from(select a.*, rownum rn from(
	SELECT 	*
	FROM	BOARD 
	WHERE 	BOARD_TYPE= #{boardType}
			<if test="searchKeyword != null and searchKeyword != ''">
		 AND ${searchCondition} like '%' || #{searchKeyword} || '%'
		</if>
	<choose>
		<when test="sortCol != null and sortCol != ''">
			ORDER BY ${sortCol}	
		</when>
		<otherwise>
			ORDER BY U_ID DESC
		</otherwise>
	</choose>
  )a ) b where rn between #{first} and #{last}

</select>



<!-- 단일게시판조회 -->
<select id="getBoard" parameterType="board" resultType="board">
	SELECT 	*
	FROM	BOARD
	WHERE 	BOARD_NUMBER = #{boardNumber}
	ORDER BY BOARD_NUMBER
</select>



<!-- 게시판 입력 -->
<insert id ="insertBoard" parameterType="board">
 <selectKey keyProperty="boardNumber" resultType="integer" order="BEFORE">
		SELECT nvl(MAX(BOARD_NUMBER),0)+1 FROM BOARD 
	</selectKey>
	INSERT INTO BOARD (	BOARD_NUMBER, BOARD_TITLE, BOARD_CONTENT, U_ID, BOARD_TYPE)
				VALUES(
					#{boardNumber},	
					#{boardTitle},			<!-- 게시판제목 -->
					#{boardContent},		<!-- 게시판내용 -->
					#{uId},					<!-- 아이디 -->
					#{boardType}			<!-- 게시판타입 -->
				)
</insert>

								
								
<!-- 게시판 수정 -->
<update id ="updateBoard" parameterType="board">
	UPDATE BOARD SET 
					BOARD_TITLE=#{boardTitle},
					BOARD_CONTENT=#{boardContent}		   
					WHERE BOARD_NUMBER=#{boardNumber}
</update>




<!-- 게시판 삭제 -->
<delete id ="deleteBoard" parameterType="board">
	DELETE FROM BOARD WHERE BOARD_NUMBER = #{boardNumber}
					
</delete>



<!-- 게시판리스트(단체) 삭제 -->
<delete id ="deleteBoardList" parameterType="board">
	DELETE BOARD 
	<if test="bnumberList != null and bnumberList.length>0">			<!-- boardVO 안의 bnumberList 사용 -->
	WHERE BOARD_NUMBER in
	<foreach collection="bnumberList" item="item" open="("  close=")" separator=",">
		#{item}
	</foreach>
	</if>
	<if test="bnumberList == null or not bnumberList.length>0">
	WHERE BOARD_NUMBER = -1
	</if>
</delete>


</mapper> 